# Event Storming
https://miro.com/app/board/uXjVK70-GU4=/?share_link_id=933162922004  
Остальные диаграммы в текущей директории с ДЗ.

# Разделение на контексты
## Тотализатор
**Почему такой контекст**:
В этой группе процессов "Заказ" - это всего лишь объект, на который можно поставить ставку.
## Подготовка расходника 
**Почему такой контекст**:
В отделе расходников есть отдельные процессы, которые никак не связаны с заказом: заказать печенье, сгенерировать текст для него, создать бланк приемки и т.д.
## Процесс обработки заказа
**Почему такой контекст:**
- Матчинг, подсчет стоимости и работа с заказом - это все взаимосвязанный Core-функционал, поэтому он может быть в одном контексте.
## Управление личным кабинетом
**Почему такой контекст:**
- Где-то должен быть data owner для менеджеров/воркеров/клиентов.
- Платежка (инвойсы и их оплата) - это небольшой модуль, поэтому включил его в контекст.
- Пока здесь же будет "админка" менеджеров (не очень много US с админкой есть), но возможно уйдет в другой контекст вместе с менеджерами
## Проверка качества
**Почему такой контекст**:
- Проверка качества нужна только для сбора статистики. 
  Данные по заказу здесь нужны для улучшения системы.
## Отбор кандидатов
**Почему такой контекст**:
- Цель компании - отобрать 3% лучших котов. Этот контекст поддерживает такой процесс. 
- Со временем отбор будет усложняться, поэтому лучше сделать его отдельным модулем, чтобы изолированно его развивать
- Процесс отбора никак не связан с процессом предоставления услуг, так как кандидат в воркеры не имеет доступа к основной системе (он же кандидат).

# Реализация проекта
## Модульный монолит для всех контекстов
**Reasoning**:
- Проект на начальной стадии - мало людей, мало наработок
- При расширении команды возникнет потребность в микросервисах, поэтому монолит модульный.
  С расчетом на то, что модули можно с меньшей болью превратить в микросервисы.
- На начальном этапе TTM и так будет высокий - не написано ещё много кода. Модульность позволит тестировать быстро гипотезы.
- Нагрузка не будет критичной первое время - 1к заявок в день, 10 заказов в день, 20 воркеров, 100 клиентов.
  К тому же процесс привлечения пользователей - это долгий процесс продаж. 
  После него бизнес увидит метрики и сможет реалистично прогнозировать скорость роста пользователей.
## Отдельный монолит "Admin Panel"
**Reasoning**:
- Админка запрашивает данные у микросервисов, а не наоборот => не является bottleneck'ом => масштабирование админки не потребуется.
- Менеджеров немного и не будет много => нагрузка на админку минимальна и масштабирование не требуется.
### Коммуникация
**Синхронная** c сервисами Core-системы (сейчас, с монолитом) через API. *Предположительно, и со всеми остальными частями системы*.
**Reasoning**: 
- Если админка начнет получать ивенты от Core-системы, то на админку падет та же нагрузка. Будет 1к/запросов в секунду на создание заказа в Core - будет и на админку.
  При синхронных запросах по требованию админка не будет сильно нагружена.
  Так как у Core системы RPS больше, чем у админки, синхронные запросы - капля в море.
- Админка по своей сути зависима от сервисов системы (агрегирует все данные внутри), поэтому ничего плохо в том, чтобы синхронного запрашивать у сервисов данные.
  Если сервис заказов упал, админка не должна иметь возможности редактировать заказ или как-то им манипулировать.
# Спорные места
- Матчинг может стать большой частью системы. Он потенциально будет завязан на характеристиках воркерах, типах услуг, "репутации" и всем таком.
  Проверка качества заказов тоже может повлиять на матчинг
- Аналогично про стоимость. Вряд ли она все время будет константой. Кажется, что это важная часть системы. Оптимальное определение стоимости заказа - это хорошее отличие от конкурентов
- Непонятно, как админку реализовать. Она потенциально будет охватывать вообще всю систему. 
- Нужно получше прикинуть, как модульный монолит будет разбиваться на микросервисы. Все же могут быть проблемы с миграцией данных
