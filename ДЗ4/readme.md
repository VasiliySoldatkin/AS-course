![image](https://github.com/VasiliySoldatkin/AS-course/assets/34882906/46866644-aa9c-4060-82a4-cbfedbf6d507)

# Instability
## Сервис воркеров
5/(5+1) = 0.83
## Fur-tune печенья
0/(0+1) = 0
## Сборка расходников
1/(2+1) = 0.33
## Сервис скоринга
2/(2+1) = 0.66
## Happy cat box
1/(1 + 0) = 1
## Планирование визитов и остальное
3/(3+3) = 0.5
## Система ставок
0/(0+2) = 0
## Расчет и списание средств
0/(0 + 2) = 0
# Что делать
## Entity-service воркеров добавить в планирование визитов
**Reasoning:**
Entity-service воркеров связан с теми же сервисами, что и сервис с планированием.
**План:**
- Коммуникацию сделать асинхронной. 
  Так как сервис с визитами Core, его масштабируемость не должна зависеть от сервисов с другой нагрузкой.
- Перенести код через Tactical Forking
  **Reason:** код ничем не отличается, схема данных та же
## Вынести матчинг в отдельный сервис
**Reasoning:**
У матчинга в силу требований (US-300) другой архитектурный стиль - pipeline.
Если соединять его с визитами, то все может превратиться в big ball of mud - TTM уменьшиться, тестирование гипотез станет медленным. Для Core-поддомена это все серьезные риски.
**План:**
- Использовать Strangler Fig Application и CDC
  Первый паттерн, если схема данных и база та же и если бизнес не согласен на feature freeze.
## Разделить расчет и списание средств на сервис клиентов и сервис сотрудников
**Reasoning:** 
Скорее всего, сервисы будут развиваться в разных направлениях. У клиентов могут в будущем быть скидки за частоту заказов, у воркеров бонусы за качество работы.
**План:**
- Tactical Forking
	**Reason:** разделение на сервисы происходит по одному if'у => можно реализовать перенаправление запросов на proxy, когда новый сервис будет создан.
# План
## Когда свободных людей и ресурсов нет, а опыт и (или) инфраструктура есть
1) Объединить воркеров с планированием и перевести все на async коммуникацию
   **Reason:** это сразу улучшит instability и характеристики по performance. При этом не надо менять данные, менять логику и фризить фичи
2) Выделить матчинг в отдельный сервис
   **Reason:** если сервис планирования визитов был и так хорошо спроектировано (опыт есть), то довольно легко можно перенести этот сервис (абстрагировать этап матчинга нужно и подменить реализацию). 
   Переделать на Pipeline архитектуру можно уже кусками в новом сервисе.
3) Разделить сервис выплат
   **Reason:** логика изначально +- одна, поэтому нет большой ценности для бизнеса в таком переносе. Поэтому в последний момент.
## Когда есть свободные люди и ресурсы, а опыта и (или) инфраструктуры нет
1) Поменять коммуникацию, связанную с сервисом воркеров, с синхронной на асинхронную.
   **Reason:** можно получить опыт в работе с EDA, сформировать микросервисные шасси
2) Разделить сервис списания и начисления на два
	**Reason:** главное здесь не потерять историю выплат и ожидаемые выплаты. В остальном можно постепенно перекидывать логику из одного сервиса в другой и ошибаться.
3) Объединить Entity-service воркеров с планированием визитов
	**Reason:** здесь уже будет какой-то опыт переноса сервисов и построения EDA, поэтому можно выносить сервис, у которого очень много связей.
4) Выделить матчинг в отдельный сервис
   **Reason:** самый сложный сервис: нужно перестраивать архитектуру и переносить данные. К тому же вполне может жить рядом с заказами до какого-то времени, так тесно связан с ними. Поэтому переносится последним.
